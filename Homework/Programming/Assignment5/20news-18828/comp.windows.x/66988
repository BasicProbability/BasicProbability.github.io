From kaiserinformatikunikoblenzde Siegfried Kaiser
Subject R5 table widget causing trouble with XtQueryGeometry

ContentsProblems with table widgets in R5

	The following part of a program an user interface for a simulation
	system did work in R4 but refused to in R5 Of cause the R4version
	did not know about the xpTableWidgetClass we used tableWidgetClass 			instead  caught from the net in times of R3 and XpTableChildPosition 			formerly XtTblPosition
	Since compiling with R5 the program causes a zero width or height error
	on sparcstations The troubleshooter is the recomputation of the
	modelinittable  table widget though its childs label and asciiText 
	widgets exist XtQueryGeometry returns a prefered width and height of 			zero 
	Thus the following asignment cannot perform anything else but set the 			width and height of the newly created widget to zero No wonder XtPopup 		or XtManage Child create zero width or height errors dependent on 			whether width and height of the shell widget are set in the resource 			file or not
	
	Question Does anyone know why XtQueryGeometry returns so low prefered
			values when working on table widgets or perhaps what
			to do about

	Ill be happy if someone is able to help me 
	Germans are requested to answer in german
	
	Siegfried Kaiser
	email kaiserunikounikoblenzde

	
	The part of interest


	 Graphischer Neuaufbau des ModelInitFormulars 
		 Storing the old width and height of the viewport	
		 widget which is the parent of the troubling table	
		 widget before the viewport widget is destroyed	
		 The destroying of widgets before resizing them is a	
		 relict from R3age					
	
	if modelinitpoppedup 
		XtUnmapWidgetmodelinitformview
	XtDestroyWidgetmodelinitformview
	
		 Creating the subtree within the shell of which the	
		 root is the viewport widget				
	
	n  0
	XtSetArgargsnXtNfromVertmodelinittitle n
	XtSetArgargsnXtNfromHorizmodelinitbuttonview n
	XtSetArgargsnXtNallowVertTrue n
	XtSetArgargsnXtNforceBarsTrue n
	modelinitformview  XtCreateWidgetformviewviewportWidgetClass
					      modelinitformargsn

	n  0
	modelinittable  XtCreateWidgettablexpTableWidgetClass
					  modelinitformviewargsn

		 createformwidget does create and position table	
		 widgets childs To position them it uses XpTable	
		 ChildPosition in R5 and XtTblPosition in R4		
					 
	createformwidgetptrmodelinitobjmodelinittable

		 							
		 The crucial function call				
		 intended to return the maximum height possible if	
		 there isnt sufficient space to show the whole table	
		 widget then the viewport shall grow as large as 	
		 possible but not beyond the border of screen	
		 If there is enough space the window is intended to	
		 shrienk to the smallest possible height		
									

	XtQueryGeometrymodelinittableNULLpref

		 According to the algorithms idea the new value of	
		 viewport widgets height is selected Unfortunately	
		 prefheight  0 leads to newheight  0		
		
	if formviewheight  prefheight newheight  prefheight
	else newheight  formviewheight

		 Setting the new values to viewport widgets ancestors	

	w  XtNameToWidgetmodelinitformformview
	XtResizeWidgetwwidthnewheightprefborderwidth
	XtResizeWidgetmodelinitformviewwidthnewheight
		       prefborderwidth

	if modelinitpoppedup
	
		 In case the shell which contains modelinitform	
		 view and modelinittable allready exists is has	
		 to be resized too					
		
	 n  0
	 XtSetArgargsnXtNwidthshellwidth n
	 XtSetArgargsnXtNheightshellheight n
	 XtSetArgargsnXtNborderWidthshellbw n
	 XtGetValuesmodelinitshellargsn
	 XtResizeWidgetmodelinitshellshellwidth
			shellheight  height  newheightshellbw
	  end of if 

	n  0
	XtSetArgargsnXtNwidthwidth n
	XtSetArgargsnXtNborderWidthbw n
	XtGetValuesmodelinitbuttonviewargsn
	XtResizeWidgetmodelinitbuttonviewwidthnewheightbw

	XtResizeWidgetvertbarsbarwidth1sbarbw
	
	resizeinits

		 If there is the shells height set within the 	
		 resource file the program terminates within the	
		 first XtManageChild on its second pass through the	
		 observed function The first pass succeeds		

	XtManageChildmodelinitformview
	XtManageChildmodelinittable


	if modelinitpoppedup
	
		 In case the shell isnt popped up it has to be done	
		 If there is no value set to the shells height within
		 the resource file the program terminates here	
		
	 XtPopupmodelinitshellXtGrabNone
	 modelinitpopflag  True
	 setmodelinitattributes
	  end of if 

	getactualinitptractual
	loadformptractual
	
	
	
									
	 If someone suspects the creation of table widgets contents	
	 causes all the trouble there are the sources of createform 
									
	
		
	createformwidgetptrtable
	tobj              ptr
	Widget             table
		
		 ptr is a linear list containing attributes and para	
		 meters of the model and additionally the correspon	
		 ding widgets						
		
	
	 Arg               args10
	 int               n
			   row
			   col
	 tobj             ptrobj
	 tident           ptrident

		 Initialization of the local variables		
		
	 ptrobj  ptr
	 col  0
	 row  0
 
	  Schleife ueber die Objekte bzw das PseudoObjekt fuer die 				Parameter 
		 loop through the list of objects and pseudoobjects	
		 every object occuring in the model has zero or more	
		 attributes and some parameters which can be shared	
		 by several objects 					
		 Because of locality the attributes of one object are	
		 listed in a second linear list of type tident	
		 whereas the parameters which can belong to any ob	
		 ject are put together in a pseudoobject 		
		 Thus the program loops through the list of objects	
		 and pseudoobjects and for each object through the	
		 list of its attributes resp parameters		
		
	 while ptrobj  tobjNULL
	 
	 	 Each object and pseudoobject is represented in a	
	 	 label widget						
	  
	  n  0
	  XtSetArgargsnXtNlabelptrobjname n
	  ptrobjlabelw  XtCreateManagedWidgetobjectlabelWidgetClass
					   tableargsn
	  XpTableChildPositionptrobjlabelwcolrow
	  col
	  row
	  ptrident  ptrobjident

	   Schleife ueber die ObjektAttribute bzw Parameter 
	  while ptrident  tidentNULL
	  
	  	 Each attribute and parameter is represented in a	
	  	 label and has a corresponding asciiText widget in 	
	  	 which it is to be initialized			
	  	
	   n  0
	   XtSetArgargsnXtNlabelptridentname n
	   ptridentlabelw  XtCreateManagedWidgetidentlabelWidgetClass
					      tableargsn
	   XpTableChildPositionptridentlabelwcolrow
	   col
    
	   n  0
	   XtSetArgargsnXtNlengthROWLENGTH n
	   XtSetArgargsnXtNstringptridenttext n
	   XtSetArgargsnXtNeditTypeXawtextEdit n
	   XtSetArgargsnXtNwrapXawtextWrapWord n
	   XtSetArgargsnXtNresizeXawtextResizeHeight n
	   XtSetArgargsnXtNuseStringInPlaceTrue n
	   ptridenttextw  XtCreateManagedWidgettext
					asciiTextWidgetClass
					     tableargsn
	   XpTableChildPositionptridenttextwcolrow
	   col
	   row
	   getnextidentptrident
	    end of while 
	  col
	  getnextobjptrobj
	   end of while 
	  end of createformwidget 


	

So far the problem in detail

