From inouecrdyokogawacojp Inoue Takeshi
Subject How to see characterset from wchart


We developed a toolkit running on the X Window System
The toolkit copes with any languages based on X11R5s i18n
facility As you know there are 2 kinds of i18n implementation from MITs 
X11R5 release  Xsi and Ximp Our original implementation of the toolkit
uses Xsi

Our toolkit manages each characters size based on our own font management system
In order to do that the wchart typed character strings must be decomposed
to character sets This means that if one wchart type compound string with 
ASCII and Kanji mixed for example is given each element of the wchart
array must be checked its corresponding character set based on a bit layout
and application environments locale In this case if the locale is japanese
each wchart character will be classified either to iso88591 jisx0208 or so

We need a function to do this The function must check how many characters
from the top are the same character set and what the character set is

We could not find any public X11R5 function to do that and inevitably used
Xsis internal functions to construct that function The following is the
source code of that function decomposeCharacterSet


I18Nh
 This may look like C code but it is really  C 
 Id I18Nhv 11 19920121 120524 iima Exp iima 

ifndef I18NH
define I18NH

include X11Xlibh

extern int decomposeCharacterSetconst wchart wcstr	 IN 
				 int wclen		 IN 
				 char buf		 OUT 
				 int buflen		 INOUT 
				 int scannedlen	 OUT 
				 char charset	 OUT 
extern XmString wcharToXmStringconst wchart wcstr
extern XmStringCharSet charsetOfWcharconst wchart wc

endif  I18NH 

I18Ncc
 Id I18Nccv 11 19920121 120505 iima Exp  

include stdlibh
include X11Xlibinth
include XmXmh
include I18Nh

extern C 
include X11wcharh
define XwcDecomposeGlyphCharset XXXXwcDecomposeGlyphCharset
define Xmbfscs XXXXmbfscs
define Xmbctidtocsid XXXXmbctidtocsid
include Xlocaleinth
undef XwcDecomposeGlyphCharset
undef Xmbfscs
undef Xmbctidtocsid
    extern int XwcDecomposeGlyphCharsetXLocale const wchart int
					 char int int int
    extern Charset XmbfscsXLocale CSID
    extern CSID XmbctidtocsidXLocale CSID


int decomposeCharacterSetconst wchart wcstr IN 
			  int wclen		 IN 
			  char buf		 OUT 
			  int buflen		 INOUT 
			  int scannedlen	 OUT 
			  char charset	 OUT 

    XLocale xlocale  XFallBackConvert
    int ctid
    int status
    Charset xcharset
    
    status  XwcDecomposeGlyphCharsetxlocale wcstr wclen buf
				       buflen scannedlen ctid
    if status  Success 
	xcharset  Xmbfscsxlocale Xmbctidtocsidxlocale ctid
	charset  xcharset  xcharsetcsname  NULL
    
    else
	charset  NULL
    return status



An included file above Xlocaleinth is also Xsi internal and we copied
the file to the toolkit directory and compiled

A serious issue occured when we tried to compile a toolkit application on
our HP machine with its OS version of HPUX901

When we tried to link an application based on our toolkit
link errors occured saying that the following functions are missing
    Xmbctidtocsid code
    Xmbfscs code
    XwcDecomposeGlyphCharset code
    XFallBackConvert code

We had used MIT release version of X11R5 and its Xsi implementation until
HPUP90 and ran applications successfully One of the reasons to use Xsi was that
because HP did not release HPs X11R5 until the OS 90 and we had no way to 
know how HPs R5 would be implemented We had hoped Xsis popularity and used 
its internal functions 

The HPs linker complains that there are no Xsi internal functions implemented
We observe from HPs libX11a they used some Ximp implementation but we are
not sure if they used MITs vanilla Ximp version or their own version of Ximp and
therefore finding just counter part functions in MITs Ximp for Xsi does not
seem to lead us a solution

My question and goal is to know how we can construct a function like
decomposeCharacterset listed above Is there any function to check
character set of each element of wchart type strings depending on locales
If it is a public function that is perfect but even if it is not we
want to use any internal functions in HPs X11R5 as we did for MITs R5

In order to render a wchart type string there must be some machinery
to judge character sets and that is how the proper fonts are selected for
the string We have no way to find out that without any HPs X11R5 source 
files We want to know how we can use that for our goal 
Any help or comments would be highly appreciated

I also appreciate if anyone tell me about Ximp treating around this area
even if it is not HPs implementation

Thank you


				Takeshi Inoue
				inouecrdyokogawacojp
				Yokogawa Electric Corporation
				Open Systems Laboratory	0422525557
